module;
#include <Windows.h>
#include <iostream>

#include "../../Classes/Process.h"
import Exception;

export module ChangePermissions;

export namespace MW::Utility
{
    bool ChangePermissions(LPVOID address, const Process &proc)
    {
        uintptr_t oldProtect;
        DWORD oldProc;

        const BOOL permissionsChanged{ VirtualProtectEx(proc.getProcHandle(), address, 4000, PAGE_READWRITE, &oldProc) };

        if (!permissionsChanged)
        {
            throw Exception("VirtualProtectEx failed to change permissions", "ChangePermissions");
        }

        std::cout << "The permission change completed succesfully\n";

        return true;
    }
}